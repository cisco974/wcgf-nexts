deployment:
  tasks:
    # 1Ô∏è‚É£ Activation de l'environnement virtuel Node.js
    - source /home/cayi7350/nodevenv/wcgf.com/22/bin/activate

    # 2Ô∏è‚É£ Configuration du bon chemin pour les modules Node.js et Next.js
    - export PATH="/home/cayi7350/nodevenv/wcgf.com/22/bin:$PATH"
    - export NODE_PATH="/home/cayi7350/nodevenv/wcgf.com/22/lib/node_modules"

    # 3Ô∏è‚É£ Acc√®s au r√©pertoire du projet
    - cd /home/cayi7350/wcgf.com

    # 4Ô∏è‚É£ Nettoyage et mise √† jour du code
    - git reset --hard origin/main
    - git pull origin main

    # 5Ô∏è‚É£ V√©rification et installation de Next.js et ses d√©pendances
    - npm install --no-bin-links --prefix /home/cayi7350/nodevenv/wcgf.com/22
    - npm install -g next

    # 6Ô∏è‚É£ V√©rification de Next.js
    - next -v || npx next -v

    # 7Ô∏è‚É£ D√©sactivation temporaire d'ESLint si n√©cessaire
    - export NEXT_DISABLE_ESLINT=1

    # 8Ô∏è‚É£ D√©finition de l'environnement de production
    - export NODE_ENV=production

    # 9Ô∏è‚É£ Build de l'application Next.js
    - npx next build

    # üîü Nettoyage du cache Next.js (optionnel)
    - rm -rf .next/cache/*

    # 1Ô∏è‚É£1Ô∏è‚É£ D√©marrage de l‚Äôapplication Next.js via PM2 (optionnel)
    - pm2 restart all || pm2 start npm --name "nextjs-app" -- run start
    - pm2 save
